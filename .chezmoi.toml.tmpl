{{/*
=======================================================================
                            PROMPTS
=======================================================================
*/}}
{{- $email := promptStringOnce . "email" "What is your email?" -}}
{{- $timezone := promptChoiceOnce . "timezone" "Choose your timezone" (list
  "UTC"
  "Europe/Berlin"
  "Europe/London"
  "Europe/Paris"
  "Europe/Vienna"
  "Europe/Zurich"
  "America/New_York"
  "America/Chicago"
  "America/Los_Angeles"
  "Asia/Tokyo"
  "Asia/Shanghai"
) "Europe/Berlin" -}}
{{- $bw_server_url := promptStringOnce . "bw_server_url" "Bitwarden server URL (self-hosted)" -}}
{{- $bw_ssh_key := promptStringOnce . "bw_ssh_key" "Bitwarden SSH key item name (leave empty to skip)" -}}
{{- $git_username := promptStringOnce . "git_username" "What should your git username be?" -}}
{{- $os := promptChoiceOnce . "os" "Choose your os" (list "arch-linux" "ubuntu") "arch-linux" -}}
{{- $headless := promptBoolOnce . "headless" "Is your system headless?" true -}}
{{- $is_gui := not $headless -}}

{{- $install_hyprland := and $is_gui (promptBoolOnce . "install_hyprland" "Do you want to install hyprland and related things?" true) -}}
{{- $install_ly := and $is_gui (promptBoolOnce . "install_ly" "Do you want to install ly (display-manager)?" true) -}}
{{- $install_kde_apps := and $is_gui (promptBoolOnce . "install_kde_apps" "Do you want to install kde-apps?" true) -}}
{{- $install_media_related_pkgs := and $is_gui (promptBoolOnce . "install_media_related_pkgs" "Do you want to install media related packages?" true) -}}
{{- $install_timeshift := promptBoolOnce . "install_timeshift" "Do you want to install timeshift and related packages?" true -}}
{{- $location := and $install_hyprland (promptStringOnce . "location" "What is your (not exact) location? (needed for weather)") -}}
{{- $gpu_vendor := and $is_gui (promptChoiceOnce . "gpu_vendor" "Which GPU vendor do you have?" (list "none" "amd" "nvidia" "intel") "none") -}}
{{- $install_gaming := and $is_gui (promptBoolOnce . "install_gaming" "Do you want to set up gaming tools and optimizations?" false) -}}
{{- $install_gui_apps := and $is_gui (promptBoolOnce . "install_gui_apps" "Do you want to install GUI applications (VS Code, Chrome, Firefox, etc.)?" true) -}}
{{- $install_dev_tools := promptBoolOnce . "install_dev_tools" "Do you want to install development tools (Docker, Maven, Terraform, Ansible)?" true -}}
{{- $install_tui_apps := promptBoolOnce . "install_tui_apps" "Do you want to install TUI applications (Yazi, Neovim, Tmux, etc.)?" true -}}
{{- $install_fonts := and $is_gui (promptBoolOnce . "install_fonts" "Do you want to install font packages?" true) -}}
{{- $install_printers_scanners := promptBoolOnce . "install_printers_scanners" "Do you want to install and configure printers and scanners (CUPS and SANE)?" true -}}

{{/*
=======================================================================
                        PACKAGE DEFINITIONS
=======================================================================
NOTE: All OS-specific package lists should be defined here.
      The logic below will combine them based on the selected OS.
*/}}

{{- $pkgs := dict -}}

{{- $_ := set $pkgs "cli_arch" (list
  "kitty" "fastfetch" "oh-my-posh" "git" "man-db" "man-pages" "less" "zoxide" "fd"
  "ripgrep" "bat" "7zip" "rar" "zip" "unzip" "rsync" "rclone" "translate-shell" "wttrbar" "npm" "syncthing"
  "lsd"
) -}}
{{- $_ := set $pkgs "cli_ubuntu" (list
  "npm"
) -}}

{{- $tui_arch_packages := list "yazi" "neovim" "tmux" "tmuxinator" "bluetui" "fzf" "impala" "ncpamixer" "tree" "btop" "nudoku" "amdgpu_top" -}}
{{- if $install_tui_apps -}}
{{-   $_ := set $pkgs "tui_arch" $tui_arch_packages -}}
{{- else -}}
{{-   $_ := set $pkgs "tui_arch" (list) -}}
{{- end -}}
{{- $_ := set $pkgs "tui_ubuntu" (list) -}}
{{- if $install_ly -}}
{{-   $_ := set $pkgs "tui_arch" (append ($pkgs.tui_arch) "ly") -}}
{{-   $_ := set $pkgs "tui_ubuntu" (append ($pkgs.tui_ubuntu) "ly") -}}
{{- end -}}

{{- $dev_arch_packages := list "docker" "docker-compose" "maven" "npm" "terraform" "ansible" -}}
{{- if $install_dev_tools -}}
{{-   $_ := set $pkgs "dev_arch" $dev_arch_packages -}}
{{- else -}}
{{-   $_ := set $pkgs "dev_arch" (list) -}}
{{- end -}}
{{- $_ := set $pkgs "dev_ubuntu" (list) -}}

{{- $gui_arch_packages := list "visual-studio-code-bin" "google-chrome" "firefox" "bitwarden" "discord" "libreoffice-still" "thunderbird" "veracrypt" "intellija-idea-ultimate-edition" -}}
{{- if $install_gui_apps -}}
{{-   $_ := set $pkgs "gui_arch" $gui_arch_packages -}}
{{- else -}}
{{-   $_ := set $pkgs "gui_arch" (list) -}}
{{- end -}}
{{- $_ := set $pkgs "gui_ubuntu" (list) -}}

{{- $fonts_arch_packages := list "ttf-0xproto-nerd" "ttf-jetbrains-mono-nerd" "noto-fonts-emoji" -}}
{{- if $install_fonts -}}
{{-   $_ := set $pkgs "fonts_arch" $fonts_arch_packages -}}
{{- else -}}
{{-   $_ := set $pkgs "fonts_arch" (list) -}}
{{- end -}}
{{- $_ := set $pkgs "fonts_ubuntu" (list) -}}

{{- $_ := set $pkgs "hyprland_arch" (list
  "hyprland" "hyprlock" "hyprshot" "hyprcursor" "rofi" "waybar" "wpaperd" "dunst"
  "rose-pine-gtk-theme-full" "bluez" "bluez-utils" "brightnessctl" "pipewire"
  "pipewire-pulse" "wireplumber" "rose-pine-hyprcursor" "dua-cli"
) -}}
{{- $_ := set $pkgs "hyprland_ubuntu" (list) -}}

{{- $_ := set $pkgs "kde_arch" (list
  "qt5ct" "qt6ct-kde" "archlinux-xdg-menu" "xdg-desktop-portal-hyprland"
  "dolphin" "ark" "okular" "kdialog" "kcalc" "keditfiletype" "isoimagewriter"
  "kvantum"
) -}}
{{- $_ := set $pkgs "kde_ubuntu" (list) -}}

{{- $_ := set $pkgs "media_arch" (list
  "feishin-bin" "ffmpeg" "ffmpegthumbnailer" "tumbler" "vlc" "vlc-plugins-all"
) -}}
{{- $_ := set $pkgs "media_ubuntu" (list) -}}

{{- $_ := set $pkgs "timeshift_arch" (list
  "timeshift" "grub-btrfs" "timeshift-autosnap"
) -}}
{{- $_ := set $pkgs "timeshift_ubuntu" (list) -}}

{{- $_ := set $pkgs "other_arch" (list) -}}
{{- $_ := set $pkgs "other_ubuntu" (list) -}}
{{- if not $headless -}}
{{-   $other_arch_packages := list "naps2" "system-config-printer" "cups" "selectdefaultapplication" -}}
{{-   $_ := set $pkgs "other_arch" (concat ($pkgs.other_arch) $other_arch_packages) -}}
{{-   $other_ubuntu_packages := list "naps2" "system-config-printer" "cups" -}}
{{- $_ := set $pkgs "other_ubuntu" (concat ($pkgs.other_ubuntu) $other_ubuntu_packages) -}}
{{- end -}}

{{- $_ := set $pkgs "npm" (list
  "@bitwarden/cli"
) -}}




{{/*
=======================================================================
                          FINAL DATA BLOCK
=======================================================================
*/}}
[data]
bw_ssh_key = {{ $bw_ssh_key | quote }}
bw_server_url = {{ $bw_server_url | quote }}
location = {{ $location | quote }}
email = {{ $email | quote }}
timezone = {{ $timezone | quote }}
git_username = {{ $git_username | quote }}
os = {{ $os | quote }}
headless = {{ $headless }}

# Installation flags
install_hyprland = {{ $install_hyprland }}
install_ly = {{ $install_ly }}
install_kde_apps = {{ $install_kde_apps }}
install_media_related_pkgs = {{ $install_media_related_pkgs }}
install_timeshift = {{ $install_timeshift }}
gpu_vendor = {{ $gpu_vendor | quote }}
install_gaming = {{ $install_gaming }}
install_gui_apps = {{ $install_gui_apps }}
install_dev_tools = {{ $install_dev_tools }}
install_tui_apps = {{ $install_tui_apps }}
install_fonts = {{ $install_fonts }}
install_printers_scanners = {{ $install_printers_scanners }}

# Combined package lists
{{- if eq $os "arch-linux" }}
pkgs_cli = {{ get $pkgs "cli_arch" | toToml }}
pkgs_tui = {{ get $pkgs "tui_arch" | toToml }}
pkgs_dev = {{ get $pkgs "dev_arch" | toToml }}
pkgs_gui = {{ get $pkgs "gui_arch" | toToml }}
pkgs_fonts = {{ get $pkgs "fonts_arch" | toToml }}
pkgs_hyprland = {{ get $pkgs "hyprland_arch" | toToml }}
pkgs_kde = {{ get $pkgs "kde_arch" | toToml }}
pkgs_media = {{ get $pkgs "media_arch" | toToml }}
pkgs_timeshift = {{ get $pkgs "timeshift_arch" | toToml }}
pkgs_other = {{ get $pkgs "other_arch" | toToml }}
pkgs_npm = {{ get $pkgs "npm" | toToml }}
{{- else if eq $os "ubuntu" }}
pkgs_cli = {{ get $pkgs "cli_ubuntu" | toToml }}
pkgs_tui = {{ get $pkgs "tui_ubuntu" | toToml }}
pkgs_dev = {{ get $pkgs "dev_ubuntu" | toToml }}
pkgs_gui = {{ get $pkgs "gui_ubuntu" | toToml }}
pkgs_fonts = {{ get $pkgs "fonts_ubuntu" | toToml }}
pkgs_hyprland = {{ get $pkgs "hyprland_ubuntu" | toToml }}
pkgs_kde = {{ get $pkgs "kde_ubuntu" | toToml }}
pkgs_media = {{ get $pkgs "media_ubuntu" | toToml }}
pkgs_timeshift = {{ get $pkgs "timeshift_ubuntu" | toToml }}
pkgs_other = {{ get $pkgs "other_ubuntu" | toToml }}
pkgs_npm = {{ get $pkgs "npm" | toToml }}
{{- end }}
